<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- GOOGLE FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <!-- FIM GOOGLE FONTES -->

    <link rel="stylesheet" href="./css/login.css">

    <title>Login | SurfChallenge </title>
</head>
<body>
        <div class="box-login">

                <h1> LOGIN </h1>
              
                <div class="textfield">
                    <label for="usuario"> Coloque o seu email cadastrado </label>
                    <input id="input_email" type="text" class="usuario" placeholder="Email">
                </div>

                <div class="textfield">
                    <label for="senha"> Coloque sua senha </label>
                    <input id="input_senha" type="password" class="senha" placeholder="Senha">
                </div>

                <button onclick="autenticar()" class="button-login"> Entrar </button>

                <!-- <div id="div_aguardar" class="loading-div">
                    <img src="../public/img/aguardando.gif" id="loading-gif">
                </div> -->
        
        </div>
</body>
</html>

<script>
    
    // // gif do aguardando
    // function aguardar() {
    //     var divAguardar = document.getElementById("div_aguardar");
    //     divAguardar.style.display = "flex";
    // }

    // // gif aguardar desaparecer

    // function finalizarAguardar() {
    //     var divAguardar = document.getElementById("div_aguardar");
    //     divAguardar.style.display = "none";
    // }

    function autenticar() {
        // aguardar();

        var email = input_email.value;
        var senha = input_senha.value;

        if (email == undefined || senha == undefined) {
            alert("Preencha todos os campos!")
            // finalizarAguardar();
            return false;
        }

        console.log("FORM LOGIN: ", email);
        console.log("FORM SENHA: ", senha);

        fetch("/usuarios/autenticar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                emailServer: email,
                senhaServer: senha
            })
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO entrar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));
                    sessionStorage.EMAIL_USUARIO = json.email;
                    sessionStorage.NOME_USUARIO = json.nome;
                });

            } else {

                console.log("Houve um erro ao tentar realizar o login!");

                resposta.text().then(texto => {
                    console.error(texto);
                    // finalizarAguardar(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }

</script>